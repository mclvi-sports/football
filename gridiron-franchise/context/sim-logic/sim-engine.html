<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gridiron Engine | Pro Football Simulator</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&family=Bebas+Neue&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-dark: #0a0a0f;
            --secondary-dark: #12141d;
            --accent-red: #e63946;
            --accent-gold: #ffd60a;
            --accent-blue: #1d3557;
            --field-green: #2d5a27;
            --field-lines: #ffffff;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --glass-bg: rgba(18, 20, 29, 0.85);
            --border-glow: rgba(230, 57, 70, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto Condensed', sans-serif;
            background: var(--primary-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(230, 57, 70, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(29, 53, 87, 0.15) 0%, transparent 50%),
                repeating-linear-gradient(0deg,
                    transparent,
                    transparent 50px,
                    rgba(255, 255, 255, 0.01) 50px,
                    rgba(255, 255, 255, 0.01) 51px);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 3px solid var(--accent-red);
            margin-bottom: 30px;
            position: relative;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 3px;
            background: var(--accent-gold);
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.5rem;
            letter-spacing: 8px;
            color: var(--text-primary);
            text-shadow: 0 0 30px rgba(230, 57, 70, 0.5);
        }

        .logo span {
            color: var(--accent-red);
        }

        .subtitle {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 6px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 20px;
        }

        /* Panels */
        .panel {
            background: var(--glass-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            backdrop-filter: blur(10px);
        }

        .panel-header {
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 3px;
            padding: 12px 15px;
            background: linear-gradient(90deg, var(--accent-red), transparent);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
        }

        .panel-content {
            padding: 15px;
        }

        /* Team Setup */
        .team-setup {
            margin-bottom: 15px;
        }

        .team-label {
            font-family: 'Oswald', sans-serif;
            font-size: 0.75rem;
            letter-spacing: 2px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .team-label::before {
            content: '';
            width: 12px;
            height: 3px;
            background: var(--accent-gold);
        }

        .team-select {
            width: 100%;
            padding: 10px 12px;
            background: var(--primary-dark);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 3px;
            color: var(--text-primary);
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .team-select:hover {
            border-color: var(--accent-red);
        }

        .team-select:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 15px rgba(255, 214, 10, 0.2);
        }

        /* Scoreboard */
        .scoreboard {
            background: linear-gradient(135deg, var(--secondary-dark), var(--primary-dark));
            border: 2px solid var(--accent-red);
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .scoreboard::before {
            content: 'LIVE';
            position: absolute;
            top: 10px;
            right: 15px;
            font-family: 'Oswald', sans-serif;
            font-size: 0.7rem;
            letter-spacing: 2px;
            color: var(--accent-red);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        .score-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-team {
            text-align: center;
            flex: 1;
        }

        .score-team-name {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .score-team-score {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.5rem;
            line-height: 1;
            color: var(--accent-gold);
            text-shadow: 0 0 20px rgba(255, 214, 10, 0.4);
        }

        .score-vs {
            font-family: 'Oswald', sans-serif;
            font-size: 1.2rem;
            color: var(--text-secondary);
            padding: 0 15px;
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.65rem;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .info-value {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Field Visualization */
        .field-container {
            background: var(--field-green);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .field {
            height: 80px;
            background: repeating-linear-gradient(90deg,
                    var(--field-green) 0px,
                    var(--field-green) 9%,
                    rgba(255, 255, 255, 0.15) 9%,
                    rgba(255, 255, 255, 0.15) 9.5%,
                    var(--field-green) 9.5%,
                    var(--field-green) 10%);
            border: 2px solid var(--field-lines);
            border-radius: 4px;
            position: relative;
        }

        .field::before,
        .field::after {
            content: '';
            position: absolute;
            top: 0;
            width: 10%;
            height: 100%;
            background: rgba(230, 57, 70, 0.3);
        }

        .field::before {
            left: 0;
        }

        .field::after {
            right: 0;
        }

        .ball-marker {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 12px;
            background: #8B4513;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: left 0.5s ease-out;
        }

        .first-down-marker {
            position: absolute;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--accent-gold);
            box-shadow: 0 0 10px var(--accent-gold);
            transition: left 0.5s ease-out;
        }

        .yard-labels {
            display: flex;
            justify-content: space-between;
            padding: 5px 10%;
            font-family: 'Oswald', sans-serif;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 2px;
            padding: 12px 20px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red), #c1121f);
            color: var(--text-primary);
            box-shadow: 0 4px 15px rgba(230, 57, 70, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.6);
        }

        .btn-secondary {
            background: var(--secondary-dark);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--accent-gold), #daa520);
            color: var(--primary-dark);
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 214, 10, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Play-by-Play */
        .play-log {
            height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-red) var(--primary-dark);
        }

        .play-log::-webkit-scrollbar {
            width: 6px;
        }

        .play-log::-webkit-scrollbar-track {
            background: var(--primary-dark);
        }

        .play-log::-webkit-scrollbar-thumb {
            background: var(--accent-red);
            border-radius: 3px;
        }

        .play-entry {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .play-entry.touchdown {
            background: linear-gradient(90deg, rgba(255, 214, 10, 0.2), transparent);
            border-left: 3px solid var(--accent-gold);
        }

        .play-entry.turnover {
            background: linear-gradient(90deg, rgba(230, 57, 70, 0.2), transparent);
            border-left: 3px solid var(--accent-red);
        }

        .play-entry.field-goal {
            background: linear-gradient(90deg, rgba(29, 53, 87, 0.3), transparent);
            border-left: 3px solid var(--accent-blue);
        }

        .play-situation {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .play-description {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .play-result {
            font-family: 'Oswald', sans-serif;
            font-size: 0.75rem;
            color: var(--accent-gold);
            margin-top: 4px;
        }

        /* Stats Panel */
        .stats-grid {
            display: grid;
            gap: 15px;
        }

        .stat-category {
            background: var(--primary-dark);
            border-radius: 4px;
            padding: 12px;
        }

        .stat-category-title {
            font-family: 'Oswald', sans-serif;
            font-size: 0.75rem;
            letter-spacing: 2px;
            color: var(--accent-gold);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 0.85rem;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-values {
            display: flex;
            gap: 20px;
            font-family: 'Oswald', sans-serif;
        }

        .stat-value {
            min-width: 35px;
            text-align: right;
        }

        .stat-value.away {
            color: #64b5f6;
        }

        .stat-value.home {
            color: #ef5350;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .logo {
                font-size: 2rem;
                letter-spacing: 4px;
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .game-info {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Loading animation */
        .simulating {
            position: relative;
        }

        .simulating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(90deg,
                    transparent,
                    transparent 40%,
                    rgba(255, 214, 10, 0.1) 50%,
                    transparent 60%,
                    transparent 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            pointer-events: none;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }
    </style>
</head>

<body>
    <div class="bg-pattern"></div>

    <div class="container">
        <header>
            <div class="logo">GRIDIRON <span>ENGINE</span></div>
            <div class="subtitle">PRO FOOTBALL SIMULATOR</div>
        </header>

        <div class="main-grid">
            <!-- Left Panel: Setup -->
            <div class="panel">
                <div class="panel-header">Team Setup</div>
                <div class="panel-content">
                    <div class="team-setup">
                        <div class="team-label">Away Team</div>
                        <select class="team-select" id="awayTeam">
                            <option value="Titans">Atlas Titans</option>
                            <option value="Wolves">Blackwood Wolves</option>
                            <option value="Storm">Coastal Storm</option>
                            <option value="Dragons" selected>Dragonfire</option>
                            <option value="Eagles">Eastmont Eagles</option>
                            <option value="Forge">Fairview Forge</option>
                            <option value="Grizzlies">Granite Grizzlies</option>
                            <option value="Hawks">Highland Hawks</option>
                            <option value="Ironclads">Iron City Ironclads</option>
                            <option value="Jaguars">Jade Bay Jaguars</option>
                            <option value="Knights">Kingston Knights</option>
                            <option value="Lions">Lakeside Lions</option>
                            <option value="Mustangs">Mesa Mustangs</option>
                            <option value="Navigators">Northport Navigators</option>
                            <option value="Outlaws">Oxbow Outlaws</option>
                            <option value="Panthers">Pinewood Panthers</option>
                            <option value="Quake">Quarry City Quake</option>
                            <option value="Rockets">Ridgemont Rockets</option>
                            <option value="Spartans">Silverton Spartans</option>
                            <option value="Thunder">Thunder Valley</option>
                            <option value="Ursas">Upland Ursas</option>
                            <option value="Vipers">Valleyforge Vipers</option>
                            <option value="Warriors">Westbrook Warriors</option>
                            <option value="Xpress">Xenith Xpress</option>
                            <option value="Yetis">Yellowstone Yetis</option>
                            <option value="Zealots">Zenith Zealots</option>
                        </select>
                    </div>
                    <div class="team-setup">
                        <div class="team-label">Home Team</div>
                        <select class="team-select" id="homeTeam">
                            <option value="Titans">Atlas Titans</option>
                            <option value="Wolves">Blackwood Wolves</option>
                            <option value="Storm">Coastal Storm</option>
                            <option value="Dragons">Dragonfire</option>
                            <option value="Eagles">Eastmont Eagles</option>
                            <option value="Forge">Fairview Forge</option>
                            <option value="Grizzlies">Granite Grizzlies</option>
                            <option value="Hawks">Highland Hawks</option>
                            <option value="Ironclads">Iron City Ironclads</option>
                            <option value="Jaguars">Jade Bay Jaguars</option>
                            <option value="Knights">Kingston Knights</option>
                            <option value="Lions">Lakeside Lions</option>
                            <option value="Mustangs">Mesa Mustangs</option>
                            <option value="Navigators">Northport Navigators</option>
                            <option value="Outlaws">Oxbow Outlaws</option>
                            <option value="Panthers">Pinewood Panthers</option>
                            <option value="Quake">Quarry City Quake</option>
                            <option value="Rockets">Ridgemont Rockets</option>
                            <option value="Spartans" selected>Silverton Spartans</option>
                            <option value="Thunder">Thunder Valley</option>
                            <option value="Ursas">Upland Ursas</option>
                            <option value="Vipers">Valleyforge Vipers</option>
                            <option value="Warriors">Westbrook Warriors</option>
                            <option value="Xpress">Xenith Xpress</option>
                            <option value="Yetis">Yellowstone Yetis</option>
                            <option value="Zealots">Zenith Zealots</option>
                        </select>
                    </div>

                    <div class="controls" style="grid-template-columns: 1fr; margin-top: 20px;">
                        <button class="btn btn-primary" id="startGame">START GAME</button>
                        <button class="btn btn-gold" id="simPlay" disabled>SIM PLAY</button>
                        <button class="btn btn-secondary" id="simDrive" disabled>SIM DRIVE</button>
                        <button class="btn btn-secondary" id="simQuarter" disabled>SIM QUARTER</button>
                        <button class="btn btn-secondary" id="simGame" disabled>SIM TO END</button>
                        <button class="btn btn-secondary" id="resetGame">RESET</button>
                        <button class="btn btn-secondary" id="toggleDebug"
                            style="background: var(--accent-blue);">DEBUG: OFF</button>
                    </div>
                </div>
            </div>

            <!-- Center Panel: Game -->
            <div>
                <!-- Scoreboard -->
                <div class="scoreboard" id="scoreboard">
                    <div class="score-teams">
                        <div class="score-team">
                            <div class="score-team-name" id="awayName">DRAGONS</div>
                            <div class="score-team-score" id="awayScore">0</div>
                        </div>
                        <div class="score-vs">VS</div>
                        <div class="score-team">
                            <div class="score-team-name" id="homeName">SPARTANS</div>
                            <div class="score-team-score" id="homeScore">0</div>
                        </div>
                    </div>
                    <div class="game-info">
                        <div class="info-item">
                            <div class="info-label">QUARTER</div>
                            <div class="info-value" id="quarter">1ST</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">TIME</div>
                            <div class="info-value" id="clock">15:00</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">DOWN</div>
                            <div class="info-value" id="down">1ST & 10</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">POSSESSION</div>
                            <div class="info-value" id="possession">--</div>
                        </div>
                    </div>
                </div>

                <!-- Field -->
                <div class="field-container">
                    <div class="field">
                        <div class="ball-marker" id="ballMarker" style="left: 65%;"></div>
                        <div class="first-down-marker" id="firstDownMarker" style="left: 75%;"></div>
                    </div>
                    <div class="yard-labels">
                        <span>GOAL</span>
                        <span>20</span>
                        <span>40</span>
                        <span>50</span>
                        <span>40</span>
                        <span>20</span>
                        <span>GOAL</span>
                    </div>
                </div>

                <!-- Play-by-Play -->
                <div class="panel">
                    <div class="panel-header">Play-by-Play</div>
                    <div class="panel-content">
                        <div class="play-log" id="playLog">
                            <div class="play-entry">
                                <div class="play-description" style="color: var(--text-secondary); text-align: center;">
                                    Select teams and press START GAME to begin simulation
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Stats -->
            <div class="panel">
                <div class="panel-header">Game Statistics</div>
                <div class="panel-content">
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-category">
                            <div class="stat-category-title">OFFENSE</div>
                            <div class="stat-row">
                                <span class="stat-label">Total Yards</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayYards">0</span>
                                    <span class="stat-value home" id="homeYards">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Passing Yards</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayPassYards">0</span>
                                    <span class="stat-value home" id="homePassYards">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Rushing Yards</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayRushYards">0</span>
                                    <span class="stat-value home" id="homeRushYards">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">First Downs</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayFirstDowns">0</span>
                                    <span class="stat-value home" id="homeFirstDowns">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-category">
                            <div class="stat-category-title">PASSING</div>
                            <div class="stat-row">
                                <span class="stat-label">Comp/Att</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayCompAtt">0/0</span>
                                    <span class="stat-value home" id="homeCompAtt">0/0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Pass TDs</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayPassTD">0</span>
                                    <span class="stat-value home" id="homePassTD">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">INTs</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayINT">0</span>
                                    <span class="stat-value home" id="homeINT">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-category">
                            <div class="stat-category-title">RUSHING</div>
                            <div class="stat-row">
                                <span class="stat-label">Carries</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayCarries">0</span>
                                    <span class="stat-value home" id="homeCarries">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Rush TDs</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayRushTD">0</span>
                                    <span class="stat-value home" id="homeRushTD">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Fumbles Lost</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayFumbles">0</span>
                                    <span class="stat-value home" id="homeFumbles">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-category">
                            <div class="stat-category-title">MISC</div>
                            <div class="stat-row">
                                <span class="stat-label">Sacks</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awaySacks">0</span>
                                    <span class="stat-value home" id="homeSacks">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Penalties</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayPenalties">0</span>
                                    <span class="stat-value home" id="homePenalties">0</span>
                                </div>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">TOP</span>
                                <div class="stat-values">
                                    <span class="stat-value away" id="awayTOP">0:00</span>
                                    <span class="stat-value home" id="homeTOP">0:00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game Engine
        class FootballSimulator {
            constructor() {
                this.reset();
            }

            reset() {
                this.debugLog = [];
                this.gameState = {
                    quarter: 1,
                    clock: 900, // 15 minutes in seconds
                    possession: null,
                    ballPosition: 75, // 0-100, where 0 is away endzone, 100 is home endzone
                    down: 1,
                    yardsToGo: 10,
                    awayScore: 0,
                    homeScore: 0,
                    gameOver: false,
                    kickoff: true
                };

                this.stats = {
                    away: {
                        totalYards: 0,
                        passYards: 0,
                        rushYards: 0,
                        firstDowns: 0,
                        completions: 0,
                        attempts: 0,
                        passTD: 0,
                        interceptions: 0,
                        carries: 0,
                        rushTD: 0,
                        fumbles: 0,
                        sacks: 0,
                        penalties: 0,
                        timeOfPossession: 0
                    },
                    home: {
                        totalYards: 0,
                        passYards: 0,
                        rushYards: 0,
                        firstDowns: 0,
                        completions: 0,
                        attempts: 0,
                        passTD: 0,
                        interceptions: 0,
                        carries: 0,
                        rushTD: 0,
                        fumbles: 0,
                        sacks: 0,
                        penalties: 0,
                        timeOfPossession: 0
                    }
                };

                this.playLog = [];
            }

            getOffensiveTeam() {
                return this.gameState.possession;
            }

            getDefensiveTeam() {
                return this.gameState.possession === 'away' ? 'home' : 'away';
            }

            // Convert ball position to yard line string
            getYardLine() {
                const pos = this.gameState.ballPosition;
                if (pos <= 0) return "Away End Zone";
                if (pos >= 100) return "Home End Zone";
                if (pos <= 50) return `Away ${pos}`;
                return `Home ${100 - pos}`;
            }

            // Simulate kickoff
            kickoff() {
                this.debugLog = [];
                const returnYards = Math.floor(Math.random() * 30) + 15; // 15-45 yard return
                const touchback = Math.random() < 0.4;

                this.debugLog.push(`KICKOFF LOGIC:`);
                this.debugLog.push(`→ Touchback probability: 40%`);
                this.debugLog.push(`→ Touchback rolled: ${touchback ? 'YES' : 'NO'}`);
                if (!touchback) {
                    this.debugLog.push(`→ Return yards generated: ${returnYards} (range: 15-45)`);
                }

                if (this.gameState.possession === 'away') {
                    // Away team kicking to home team
                    this.gameState.possession = 'home';
                    this.gameState.ballPosition = touchback ? 75 : Math.min(75, 100 - returnYards);
                    this.debugLog.push(`→ Home team receives, ball spotted at ${this.gameState.ballPosition} yard line`);
                } else {
                    // Home team kicking to away team
                    this.gameState.possession = 'away';
                    this.gameState.ballPosition = touchback ? 25 : Math.max(25, returnYards);
                    this.debugLog.push(`→ Away team receives, ball spotted at ${this.gameState.ballPosition} yard line`);
                }

                this.gameState.down = 1;
                this.gameState.yardsToGo = 10;
                this.gameState.kickoff = false;

                const desc = touchback
                    ? `Touchback. ${this.gameState.possession === 'away' ? awayTeam : homeTeam} ball at the 25.`
                    : `Kickoff returned ${returnYards} yards.`;

                return { type: 'kickoff', description: desc, debug: [...this.debugLog] };
            }

            // Main play simulation
            simulatePlay() {
                if (this.gameState.gameOver) return null;

                if (this.gameState.kickoff) {
                    const result = this.kickoff();
                    this.advanceClock(5);
                    return result;
                }

                this.debugLog = [];
                const offense = this.getOffensiveTeam();
                const defense = this.getDefensiveTeam();

                this.debugLog.push(`SITUATION: ${this.gameState.down}${this.getOrdinal(this.gameState.down)} & ${this.gameState.yardsToGo} at the ${this.getYardLine()}`);
                this.debugLog.push(`POSSESSION: ${offense === 'away' ? awayTeam : homeTeam} (${offense})`);

                // Decide play type based on situation
                const playType = this.selectPlayType();
                let result;

                switch (playType) {
                    case 'run':
                        result = this.simulateRun(offense, defense);
                        break;
                    case 'pass':
                        result = this.simulatePass(offense, defense);
                        break;
                    case 'punt':
                        result = this.simulatePunt(offense);
                        break;
                    case 'fieldGoal':
                        result = this.simulateFieldGoal(offense);
                        break;
                }

                // Check for penalty
                const penaltyRoll = Math.random();
                this.debugLog.push(`PENALTY CHECK: Rolled ${(penaltyRoll * 100).toFixed(1)}% (need <8% for penalty)`);
                if (penaltyRoll < 0.08) {
                    this.debugLog.push(`→ PENALTY TRIGGERED`);
                    result = this.applyPenalty(result, offense, defense);
                }

                const timeUsed = result.timeUsed || this.getPlayTime();
                this.debugLog.push(`CLOCK: ${timeUsed} seconds elapsed`);
                this.advanceClock(timeUsed);
                this.stats[offense].timeOfPossession += timeUsed;

                result.debug = [...this.debugLog];
                return result;
            }

            getOrdinal(n) {
                const s = ['th', 'st', 'nd', 'rd'];
                const v = n % 100;
                return (s[(v - 20) % 10] || s[v] || s[0]);
            }

            selectPlayType() {
                const { down, yardsToGo, ballPosition, possession } = this.gameState;
                const inFGRange = (possession === 'away' && ballPosition >= 65) ||
                    (possession === 'home' && ballPosition <= 35);

                this.debugLog.push(`PLAY SELECTION:`);
                this.debugLog.push(`→ Down: ${down}, Yards to go: ${yardsToGo}`);
                this.debugLog.push(`→ Field position: ${ballPosition}, In FG range: ${inFGRange ? 'YES (≤37 yards)' : 'NO'}`);

                // 4th down decisions
                if (down === 4) {
                    this.debugLog.push(`→ 4th down decision tree:`);
                    if (yardsToGo <= 2) {
                        const goForItRoll = Math.random();
                        this.debugLog.push(`  → Short yardage (≤2): 30% chance to go for it, rolled ${(goForItRoll * 100).toFixed(1)}%`);
                        if (goForItRoll < 0.3) {
                            const playChoice = Math.random() < 0.5 ? 'run' : 'pass';
                            this.debugLog.push(`  → DECISION: Go for it with ${playChoice.toUpperCase()}`);
                            return playChoice;
                        }
                    }
                    if (inFGRange) {
                        this.debugLog.push(`  → DECISION: Attempt FIELD GOAL`);
                        return 'fieldGoal';
                    }
                    this.debugLog.push(`  → DECISION: PUNT`);
                    return 'punt';
                }

                // Normal play selection
                let passRate = 0.55;
                this.debugLog.push(`→ Base pass rate: 55%`);

                if (yardsToGo > 7) {
                    passRate += 0.15;
                    this.debugLog.push(`→ Long yardage (>7): +15% pass rate`);
                }
                if (down === 3) {
                    passRate += 0.1;
                    this.debugLog.push(`→ 3rd down: +10% pass rate`);
                }

                const playRoll = Math.random();
                this.debugLog.push(`→ Final pass rate: ${(passRate * 100).toFixed(0)}%, rolled ${(playRoll * 100).toFixed(1)}%`);

                const choice = playRoll < passRate ? 'pass' : 'run';
                this.debugLog.push(`→ DECISION: ${choice.toUpperCase()}`);
                return choice;
            }

            simulateRun(offense, defense) {
                this.stats[offense].carries++;

                this.debugLog.push(`RUN PLAY EXECUTION:`);

                // Base yards: -3 to 12, weighted toward 3-5
                const roll1 = Math.floor(Math.random() * 8);
                const roll2 = Math.floor(Math.random() * 5);
                let yards = roll1 + roll2 - 2;
                this.debugLog.push(`→ Base yardage: roll1(${roll1}) + roll2(${roll2}) - 2 = ${yards} yards`);

                // Big play chance
                const bigPlayRoll = Math.random();
                this.debugLog.push(`→ Big play check: ${(bigPlayRoll * 100).toFixed(1)}% (need <5%)`);
                if (bigPlayRoll < 0.05) {
                    yards = Math.floor(Math.random() * 30) + 15;
                    this.debugLog.push(`→ BIG PLAY! New yardage: ${yards} yards (range: 15-45)`);
                }

                // Fumble chance
                const fumbleRoll = Math.random();
                this.debugLog.push(`→ Fumble check: ${(fumbleRoll * 100).toFixed(2)}% (need <1.5%)`);
                if (fumbleRoll < 0.015) {
                    this.stats[offense].fumbles++;
                    this.debugLog.push(`→ FUMBLE! Turnover.`);
                    return this.handleTurnover(offense, 'fumble', yards);
                }

                this.debugLog.push(`→ Final result: ${yards} yard gain`);
                return this.processYardage(offense, yards, 'run');
            }

            simulatePass(offense, defense) {
                this.stats[offense].attempts++;

                this.debugLog.push(`PASS PLAY EXECUTION:`);

                // Sack chance
                const sackRoll = Math.random();
                this.debugLog.push(`→ Sack check: ${(sackRoll * 100).toFixed(1)}% (need <7%)`);
                if (sackRoll < 0.07) {
                    const sackYards = -(Math.floor(Math.random() * 8) + 3);
                    this.stats[defense].sacks++;
                    this.debugLog.push(`→ SACKED! Loss of ${Math.abs(sackYards)} yards`);
                    return this.processYardage(offense, sackYards, 'sack');
                }

                // Completion rate ~65%
                const completionRoll = Math.random();
                this.debugLog.push(`→ Completion check: ${(completionRoll * 100).toFixed(1)}% (need <65%)`);
                const completed = completionRoll < 0.65;

                if (!completed) {
                    this.debugLog.push(`→ Pass INCOMPLETE`);

                    // Interception chance on incompletions
                    const intRoll = Math.random();
                    this.debugLog.push(`→ Interception check: ${(intRoll * 100).toFixed(1)}% (need <8%)`);
                    if (intRoll < 0.08) {
                        this.stats[offense].interceptions++;
                        this.debugLog.push(`→ INTERCEPTED! Turnover.`);
                        return this.handleTurnover(offense, 'interception', 0);
                    }

                    return {
                        type: 'pass',
                        description: 'Pass incomplete.',
                        yards: 0,
                        result: 'incomplete'
                    };
                }

                this.stats[offense].completions++;
                this.debugLog.push(`→ Pass COMPLETE`);

                // Yards: 0-15 typical, with chance for big play
                const yardRoll1 = Math.floor(Math.random() * 12);
                const yardRoll2 = Math.floor(Math.random() * 6);
                let yards = yardRoll1 + yardRoll2;
                this.debugLog.push(`→ Base yardage: ${yardRoll1} + ${yardRoll2} = ${yards} yards`);

                const bigPlayRoll = Math.random();
                this.debugLog.push(`→ Big play check: ${(bigPlayRoll * 100).toFixed(1)}% (need <8%)`);
                if (bigPlayRoll < 0.08) {
                    yards = Math.floor(Math.random() * 40) + 20;
                    this.debugLog.push(`→ BIG PLAY! New yardage: ${yards} yards (range: 20-60)`);
                }

                this.debugLog.push(`→ Final result: ${yards} yard gain`);
                return this.processYardage(offense, yards, 'pass');
            }

            simulatePunt(offense) {
                this.debugLog.push(`PUNT EXECUTION:`);

                const puntYards = Math.floor(Math.random() * 20) + 35; // 35-55 yards
                const touchbackRoll = Math.random();
                const touchback = touchbackRoll < 0.15;

                this.debugLog.push(`→ Punt distance: ${puntYards} yards (range: 35-55)`);
                this.debugLog.push(`→ Touchback check: ${(touchbackRoll * 100).toFixed(1)}% (need <15%)`);

                if (offense === 'away') {
                    this.gameState.ballPosition = touchback ? 80 :
                        Math.min(95, this.gameState.ballPosition + puntYards);
                } else {
                    this.gameState.ballPosition = touchback ? 20 :
                        Math.max(5, this.gameState.ballPosition - puntYards);
                }

                this.debugLog.push(`→ Ball spotted at: ${this.gameState.ballPosition}`);
                this.debugLog.push(`→ Possession changes to ${offense === 'away' ? 'home' : 'away'} team`);
                this.changePossession();

                return {
                    type: 'punt',
                    description: `Punt for ${puntYards} yards.${touchback ? ' Touchback.' : ''}`,
                    yards: puntYards
                };
            }

            simulateFieldGoal(offense) {
                this.debugLog.push(`FIELD GOAL ATTEMPT:`);

                const distance = offense === 'away'
                    ? (100 - this.gameState.ballPosition) + 17
                    : this.gameState.ballPosition + 17;

                this.debugLog.push(`→ Attempt distance: ${distance} yards (ball position + 17)`);

                // Success rate decreases with distance
                const successRate = Math.max(0.3, 1 - (distance - 20) * 0.015);
                this.debugLog.push(`→ Success rate: ${(successRate * 100).toFixed(0)}% (decreases 1.5% per yard over 20)`);

                const fgRoll = Math.random();
                this.debugLog.push(`→ Kick roll: ${(fgRoll * 100).toFixed(1)}%`);
                const made = fgRoll < successRate;

                if (made) {
                    this.debugLog.push(`→ FIELD GOAL IS GOOD!`);
                    this.gameState[offense + 'Score'] += 3;
                    this.gameState.kickoff = true;
                    return {
                        type: 'fieldGoal',
                        description: `${distance}-yard field goal is GOOD!`,
                        points: 3,
                        result: 'made'
                    };
                } else {
                    this.debugLog.push(`→ FIELD GOAL MISSED`);
                    this.changePossession();
                    // Ball goes to spot of kick on miss
                    if (offense === 'away') {
                        this.gameState.ballPosition = Math.max(20, this.gameState.ballPosition);
                    } else {
                        this.gameState.ballPosition = Math.min(80, this.gameState.ballPosition);
                    }
                    this.debugLog.push(`→ Possession changes, ball at ${this.gameState.ballPosition}`);
                    return {
                        type: 'fieldGoal',
                        description: `${distance}-yard field goal attempt is NO GOOD.`,
                        result: 'missed'
                    };
                }
            }

            processYardage(offense, yards, playType) {
                const previousPosition = this.gameState.ballPosition;

                this.debugLog.push(`YARDAGE PROCESSING:`);
                this.debugLog.push(`→ Previous ball position: ${previousPosition}`);

                // Update ball position
                if (offense === 'away') {
                    this.gameState.ballPosition = Math.max(0, Math.min(100,
                        this.gameState.ballPosition + yards));
                } else {
                    this.gameState.ballPosition = Math.max(0, Math.min(100,
                        this.gameState.ballPosition - yards));
                }
                this.debugLog.push(`→ New ball position: ${this.gameState.ballPosition}`);

                // Update stats
                if (playType === 'run' && yards > 0) {
                    this.stats[offense].rushYards += yards;
                    this.stats[offense].totalYards += yards;
                } else if (playType === 'pass' && yards > 0) {
                    this.stats[offense].passYards += yards;
                    this.stats[offense].totalYards += yards;
                } else if (playType === 'sack') {
                    this.stats[offense].passYards += yards; // negative
                    this.stats[offense].totalYards += yards;
                }

                // Check for touchdown
                if ((offense === 'away' && this.gameState.ballPosition >= 100) ||
                    (offense === 'home' && this.gameState.ballPosition <= 0)) {
                    this.debugLog.push(`→ TOUCHDOWN! Ball crossed goal line.`);
                    return this.handleTouchdown(offense, yards, playType);
                }

                // Update down and distance
                const previousYardsToGo = this.gameState.yardsToGo;
                this.gameState.yardsToGo -= yards;
                this.debugLog.push(`→ Yards to go: ${previousYardsToGo} - ${yards} = ${this.gameState.yardsToGo}`);

                if (this.gameState.yardsToGo <= 0) {
                    this.stats[offense].firstDowns++;
                    this.gameState.down = 1;
                    this.gameState.yardsToGo = 10;
                    this.debugLog.push(`→ FIRST DOWN earned! Reset to 1st & 10`);

                    return {
                        type: playType,
                        description: this.getPlayDescription(playType, yards),
                        yards: yards,
                        result: 'firstDown'
                    };
                } else {
                    this.gameState.down++;
                    this.debugLog.push(`→ Down advances to ${this.gameState.down}`);

                    if (this.gameState.down > 4) {
                        this.debugLog.push(`→ TURNOVER ON DOWNS! Possession changes.`);
                        this.changePossession();
                        return {
                            type: playType,
                            description: this.getPlayDescription(playType, yards) + ' Turnover on downs.',
                            yards: yards,
                            result: 'turnoverOnDowns'
                        };
                    }

                    return {
                        type: playType,
                        description: this.getPlayDescription(playType, yards),
                        yards: yards,
                        result: 'normal'
                    };
                }
            }

            handleTouchdown(offense, yards, playType) {
                this.gameState[offense + 'Score'] += 6;

                if (playType === 'run') {
                    this.stats[offense].rushTD++;
                } else if (playType === 'pass') {
                    this.stats[offense].passTD++;
                }

                // Extra point (simplified - always attempt, 94% success)
                const xpRoll = Math.random();
                const xpMade = xpRoll < 0.94;

                this.debugLog.push(`TOUCHDOWN SCORED:`);
                this.debugLog.push(`→ Type: ${playType === 'pass' ? 'Passing' : 'Rushing'} TD`);
                this.debugLog.push(`→ Extra point attempt: ${(xpRoll * 100).toFixed(1)}% (need <94%)`);
                this.debugLog.push(`→ Extra point: ${xpMade ? 'GOOD' : 'NO GOOD'}`);

                if (xpMade) {
                    this.gameState[offense + 'Score'] += 1;
                }

                this.gameState.kickoff = true;
                this.debugLog.push(`→ Kickoff next`);

                return {
                    type: 'touchdown',
                    description: `TOUCHDOWN! ${playType === 'pass' ? 'Pass' : 'Rush'} for ${yards} yards! Extra point ${xpMade ? 'GOOD' : 'NO GOOD'}.`,
                    yards: yards,
                    points: xpMade ? 7 : 6,
                    result: 'touchdown'
                };
            }

            handleTurnover(offense, type, yards) {
                const defense = this.getDefensiveTeam();
                this.changePossession();

                return {
                    type: 'turnover',
                    description: type === 'interception'
                        ? 'INTERCEPTED! Turnover.'
                        : `FUMBLE! ${defense === 'away' ? awayTeam : homeTeam} recovers.`,
                    yards: yards,
                    result: type
                };
            }

            applyPenalty(originalResult, offense, defense) {
                const penalties = [
                    { name: 'False Start', yards: 5, onOffense: true },
                    { name: 'Holding', yards: 10, onOffense: true },
                    { name: 'Pass Interference', yards: 15, onOffense: false },
                    { name: 'Offsides', yards: 5, onOffense: false },
                    { name: 'Illegal Formation', yards: 5, onOffense: true },
                    { name: 'Roughing the Passer', yards: 15, onOffense: false }
                ];

                const penalty = penalties[Math.floor(Math.random() * penalties.length)];
                const penaltyOn = penalty.onOffense ? offense : defense;

                this.stats[penaltyOn].penalties++;

                // Apply penalty yards
                if (penalty.onOffense) {
                    if (offense === 'away') {
                        this.gameState.ballPosition -= penalty.yards;
                    } else {
                        this.gameState.ballPosition += penalty.yards;
                    }
                    this.gameState.yardsToGo += penalty.yards;
                } else {
                    if (offense === 'away') {
                        this.gameState.ballPosition += penalty.yards;
                    } else {
                        this.gameState.ballPosition -= penalty.yards;
                    }
                    if (penalty.yards >= this.gameState.yardsToGo) {
                        this.stats[offense].firstDowns++;
                        this.gameState.down = 1;
                        this.gameState.yardsToGo = 10;
                    }
                }

                return {
                    ...originalResult,
                    penalty: penalty.name,
                    penaltyYards: penalty.yards,
                    description: originalResult.description + ` PENALTY: ${penalty.name}, ${penalty.yards} yards.`
                };
            }

            changePossession() {
                this.gameState.possession = this.gameState.possession === 'away' ? 'home' : 'away';
                this.gameState.down = 1;
                this.gameState.yardsToGo = 10;
            }

            getPlayDescription(playType, yards) {
                if (playType === 'sack') {
                    return `Quarterback sacked for a loss of ${Math.abs(yards)} yards.`;
                }
                if (playType === 'pass') {
                    return `Pass complete for ${yards} yards.`;
                }
                if (playType === 'run') {
                    return yards > 0
                        ? `Run for ${yards} yards.`
                        : `Run stopped for ${yards === 0 ? 'no gain' : `a loss of ${Math.abs(yards)}`}.`;
                }
                return '';
            }

            getPlayTime() {
                return Math.floor(Math.random() * 20) + 20; // 20-40 seconds per play
            }

            advanceClock(seconds) {
                this.gameState.clock -= seconds;

                if (this.gameState.clock <= 0) {
                    this.gameState.quarter++;

                    if (this.gameState.quarter > 4) {
                        // Check for tie - simplified, no OT
                        this.gameState.gameOver = true;
                    } else {
                        this.gameState.clock = 900;

                        // Half time - switch possession
                        if (this.gameState.quarter === 3) {
                            this.gameState.kickoff = true;
                            this.gameState.possession = this.gameState.possession === 'away' ? 'home' : 'away';
                        }
                    }
                }
            }

            formatClock() {
                const minutes = Math.floor(this.gameState.clock / 60);
                const seconds = this.gameState.clock % 60;
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            formatQuarter() {
                const quarters = ['1ST', '2ND', '3RD', '4TH'];
                return this.gameState.gameOver ? 'FINAL' : quarters[this.gameState.quarter - 1];
            }

            formatDown() {
                if (this.gameState.kickoff) return 'KICKOFF';
                const downs = ['1ST', '2ND', '3RD', '4TH'];
                const toGo = this.gameState.yardsToGo > 0 ? this.gameState.yardsToGo : 'GOAL';
                return `${downs[this.gameState.down - 1]} & ${toGo}`;
            }

            formatTOP(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }
        }

        // UI Controller
        let simulator = new FootballSimulator();
        let awayTeam = 'Dragons';
        let homeTeam = 'Spartans';
        let gameStarted = false;
        let debugMode = false;

        // DOM Elements
        const elements = {
            awayTeamSelect: document.getElementById('awayTeam'),
            homeTeamSelect: document.getElementById('homeTeam'),
            startBtn: document.getElementById('startGame'),
            simPlayBtn: document.getElementById('simPlay'),
            simDriveBtn: document.getElementById('simDrive'),
            simQuarterBtn: document.getElementById('simQuarter'),
            simGameBtn: document.getElementById('simGame'),
            resetBtn: document.getElementById('resetGame'),
            toggleDebugBtn: document.getElementById('toggleDebug'),
            awayName: document.getElementById('awayName'),
            homeName: document.getElementById('homeName'),
            awayScore: document.getElementById('awayScore'),
            homeScore: document.getElementById('homeScore'),
            quarter: document.getElementById('quarter'),
            clock: document.getElementById('clock'),
            down: document.getElementById('down'),
            possession: document.getElementById('possession'),
            ballMarker: document.getElementById('ballMarker'),
            firstDownMarker: document.getElementById('firstDownMarker'),
            playLog: document.getElementById('playLog')
        };

        function updateDisplay() {
            const state = simulator.gameState;
            const stats = simulator.stats;

            // Scoreboard
            elements.awayScore.textContent = state.awayScore;
            elements.homeScore.textContent = state.homeScore;
            elements.quarter.textContent = simulator.formatQuarter();
            elements.clock.textContent = simulator.formatClock();
            elements.down.textContent = simulator.formatDown();
            elements.possession.textContent = state.possession
                ? (state.possession === 'away' ? awayTeam.substring(0, 3).toUpperCase() : homeTeam.substring(0, 3).toUpperCase())
                : '--';

            // Field position (10% padding on each side for endzones)
            const fieldPercent = 10 + (state.ballPosition * 0.8);
            elements.ballMarker.style.left = `${fieldPercent}%`;

            // First down marker
            let firstDownPos;
            if (state.possession === 'away') {
                firstDownPos = Math.min(100, state.ballPosition + simulator.gameState.yardsToGo);
            } else {
                firstDownPos = Math.max(0, state.ballPosition - simulator.gameState.yardsToGo);
            }
            const fdPercent = 10 + (firstDownPos * 0.8);
            elements.firstDownMarker.style.left = `${fdPercent}%`;

            // Stats
            document.getElementById('awayYards').textContent = stats.away.totalYards;
            document.getElementById('homeYards').textContent = stats.home.totalYards;
            document.getElementById('awayPassYards').textContent = stats.away.passYards;
            document.getElementById('homePassYards').textContent = stats.home.passYards;
            document.getElementById('awayRushYards').textContent = stats.away.rushYards;
            document.getElementById('homeRushYards').textContent = stats.home.rushYards;
            document.getElementById('awayFirstDowns').textContent = stats.away.firstDowns;
            document.getElementById('homeFirstDowns').textContent = stats.home.firstDowns;
            document.getElementById('awayCompAtt').textContent = `${stats.away.completions}/${stats.away.attempts}`;
            document.getElementById('homeCompAtt').textContent = `${stats.home.completions}/${stats.home.attempts}`;
            document.getElementById('awayPassTD').textContent = stats.away.passTD;
            document.getElementById('homePassTD').textContent = stats.home.passTD;
            document.getElementById('awayINT').textContent = stats.away.interceptions;
            document.getElementById('homeINT').textContent = stats.home.interceptions;
            document.getElementById('awayCarries').textContent = stats.away.carries;
            document.getElementById('homeCarries').textContent = stats.home.carries;
            document.getElementById('awayRushTD').textContent = stats.away.rushTD;
            document.getElementById('homeRushTD').textContent = stats.home.rushTD;
            document.getElementById('awayFumbles').textContent = stats.away.fumbles;
            document.getElementById('homeFumbles').textContent = stats.home.fumbles;
            document.getElementById('awaySacks').textContent = stats.away.sacks;
            document.getElementById('homeSacks').textContent = stats.home.sacks;
            document.getElementById('awayPenalties').textContent = stats.away.penalties;
            document.getElementById('homePenalties').textContent = stats.home.penalties;
            document.getElementById('awayTOP').textContent = simulator.formatTOP(stats.away.timeOfPossession);
            document.getElementById('homeTOP').textContent = simulator.formatTOP(stats.home.timeOfPossession);
        }

        function addPlayToLog(result) {
            if (!result) return;

            const state = simulator.gameState;
            const entry = document.createElement('div');
            entry.className = 'play-entry';

            if (result.type === 'touchdown' || result.type === 'fieldGoal' && result.result === 'made') {
                entry.classList.add('touchdown');
            } else if (result.type === 'turnover') {
                entry.classList.add('turnover');
            } else if (result.type === 'fieldGoal') {
                entry.classList.add('field-goal');
            }

            const situation = `Q${state.quarter} ${simulator.formatClock()} | ${simulator.getYardLine()}`;

            let debugHtml = '';
            if (debugMode && result.debug && result.debug.length > 0) {
                debugHtml = `
                    <div class="debug-info" style="
                        margin-top: 8px;
                        padding: 10px;
                        background: rgba(0,0,0,0.4);
                        border-left: 2px solid var(--accent-gold);
                        font-family: 'Roboto Condensed', monospace;
                        font-size: 0.75rem;
                        color: var(--text-secondary);
                        line-height: 1.6;
                        white-space: pre-wrap;
                    ">
                        <div style="color: var(--accent-gold); font-weight: bold; margin-bottom: 5px;">ENGINE LOGIC:</div>
                        ${result.debug.map(line => {
                    if (line.includes('DECISION:') || line.includes('GOOD') || line.includes('TOUCHDOWN') || line.includes('FIRST DOWN')) {
                        return `<span style="color: #4caf50;">${line}</span>`;
                    } else if (line.includes('FUMBLE') || line.includes('INTERCEPTED') || line.includes('SACKED') || line.includes('MISSED') || line.includes('TURNOVER') || line.includes('NO GOOD')) {
                        return `<span style="color: var(--accent-red);">${line}</span>`;
                    } else if (line.endsWith(':')) {
                        return `<span style="color: var(--accent-gold); font-weight: bold;">${line}</span>`;
                    }
                    return line;
                }).join('\n')}
                    </div>
                `;
            }

            entry.innerHTML = `
                <div class="play-situation">${situation}</div>
                <div class="play-description">${result.description}</div>
                ${result.result === 'firstDown' ? '<div class="play-result">FIRST DOWN</div>' : ''}
                ${debugHtml}
            `;

            elements.playLog.insertBefore(entry, elements.playLog.firstChild);
        }

        function startGame() {
            awayTeam = elements.awayTeamSelect.value;
            homeTeam = elements.homeTeamSelect.value;

            elements.awayName.textContent = awayTeam.toUpperCase();
            elements.homeName.textContent = homeTeam.toUpperCase();

            simulator.reset();

            // Coin toss - random team receives
            simulator.gameState.possession = Math.random() < 0.5 ? 'away' : 'home';

            gameStarted = true;

            elements.startBtn.disabled = true;
            elements.simPlayBtn.disabled = false;
            elements.simDriveBtn.disabled = false;
            elements.simQuarterBtn.disabled = false;
            elements.simGameBtn.disabled = false;
            elements.awayTeamSelect.disabled = true;
            elements.homeTeamSelect.disabled = true;

            elements.playLog.innerHTML = '';

            const coinResult = simulator.gameState.possession === 'away' ? awayTeam : homeTeam;
            addPlayToLog({
                type: 'info',
                description: `${coinResult} wins the toss and will receive.`
            });

            updateDisplay();
        }

        function simPlay() {
            if (simulator.gameState.gameOver) return;

            const result = simulator.simulatePlay();
            addPlayToLog(result);
            updateDisplay();

            if (simulator.gameState.gameOver) {
                endGame();
            }
        }

        function simDrive() {
            if (simulator.gameState.gameOver) return;

            const startingPossession = simulator.gameState.possession;
            let playCount = 0;
            const maxPlays = 20; // Safety limit

            while (!simulator.gameState.gameOver &&
                simulator.gameState.possession === startingPossession &&
                playCount < maxPlays) {
                const result = simulator.simulatePlay();
                addPlayToLog(result);
                playCount++;

                // Break on scoring or turnover
                if (result.type === 'touchdown' || result.type === 'turnover' ||
                    result.type === 'fieldGoal' || result.type === 'punt') {
                    break;
                }
            }

            updateDisplay();

            if (simulator.gameState.gameOver) {
                endGame();
            }
        }

        function simQuarter() {
            if (simulator.gameState.gameOver) return;

            const startingQuarter = simulator.gameState.quarter;

            while (!simulator.gameState.gameOver &&
                simulator.gameState.quarter === startingQuarter) {
                const result = simulator.simulatePlay();
                addPlayToLog(result);
            }

            updateDisplay();

            if (simulator.gameState.gameOver) {
                endGame();
            }
        }

        function simGame() {
            if (simulator.gameState.gameOver) return;

            while (!simulator.gameState.gameOver) {
                const result = simulator.simulatePlay();
                addPlayToLog(result);
            }

            updateDisplay();
            endGame();
        }

        function endGame() {
            elements.simPlayBtn.disabled = true;
            elements.simDriveBtn.disabled = true;
            elements.simQuarterBtn.disabled = true;
            elements.simGameBtn.disabled = true;

            const state = simulator.gameState;
            let winner;
            if (state.awayScore > state.homeScore) {
                winner = awayTeam;
            } else if (state.homeScore > state.awayScore) {
                winner = homeTeam;
            } else {
                winner = 'TIE';
            }

            addPlayToLog({
                type: 'final',
                description: winner === 'TIE'
                    ? `FINAL: Game ends in a tie, ${state.awayScore}-${state.homeScore}`
                    : `FINAL: ${winner} wins ${Math.max(state.awayScore, state.homeScore)}-${Math.min(state.awayScore, state.homeScore)}!`
            });
        }

        function resetGame() {
            simulator.reset();
            gameStarted = false;

            elements.startBtn.disabled = false;
            elements.simPlayBtn.disabled = true;
            elements.simDriveBtn.disabled = true;
            elements.simQuarterBtn.disabled = true;
            elements.simGameBtn.disabled = true;
            elements.awayTeamSelect.disabled = false;
            elements.homeTeamSelect.disabled = false;

            elements.playLog.innerHTML = `
                <div class="play-entry">
                    <div class="play-description" style="color: var(--text-secondary); text-align: center;">
                        Select teams and press START GAME to begin simulation
                    </div>
                </div>
            `;

            updateDisplay();
        }

        // Event Listeners
        elements.startBtn.addEventListener('click', startGame);
        elements.simPlayBtn.addEventListener('click', simPlay);
        elements.simDriveBtn.addEventListener('click', simDrive);
        elements.simQuarterBtn.addEventListener('click', simQuarter);
        elements.simGameBtn.addEventListener('click', simGame);
        elements.resetBtn.addEventListener('click', resetGame);

        elements.toggleDebugBtn.addEventListener('click', function () {
            debugMode = !debugMode;
            this.textContent = debugMode ? 'DEBUG: ON' : 'DEBUG: OFF';
            this.style.background = debugMode ? 'var(--accent-gold)' : 'var(--accent-blue)';
            this.style.color = debugMode ? 'var(--primary-dark)' : 'var(--text-primary)';
        });

        // Initialize display
        updateDisplay();
    </script>
</body>

</html>